<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>字典管理</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="/static/dist/css/ionicons.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap4.css">


  <link rel="stylesheet" href="/static/plugins/iCheck/all.css">

 <!--  <link rel="stylesheet" href="/static/dist/css/bootstrap-tagsinput.css">-->

  <!-- Select2 -->
  <link rel="stylesheet" href="/static/plugins/select2/select2.min.css">

<link rel="stylesheet" href="/static/tooltipster/tooltipster.bundle.min.css" />
 <!-- 图片放大css-->
<link rel="stylesheet" href="/static/css/imgSize.css" />
  <!-- Theme style 放最下面，否则有些插件显示样式会不统一-->
  <link rel="stylesheet" href="/static/dist/css/adminlte.min.css">
    <style type="text/css">

</style>
</head>


<body class="hold-transition sidebar-mini">
<section class="content">
    <div class="row" style="margin-top:20px;margin-left:1px;">
      <div class="input-group col-2">
          <div class="input-group-prepend">
            <span class="input-group-text"><i class="fa fa-info  fa-lg"></i></span>
          </div>
          <input id="typeSearch" type="text" class="form-control" placeholder="类型">
      </div>
      <div class="input-group col-2">
          <div class="input-group-prepend">
            <span class="input-group-text"><i class="fa fa-book  fa-lg"></i></span>
          </div>
          <input id="nameSearch" type="text" class="form-control" placeholder="名称">
      </div>
      <div class="input-group col-2">
          <div class="input-group-prepend">
            <span class="input-group-text"><i class="fa fa-tag  fa-lg"></i></span>
          </div>
          <input id="valueSearch" type="text" class="form-control" placeholder="值">
      </div>

      <div class="col-1"> <button class="btn btn-primary" onclick="init(1)"><i class="fa fa-search"></i> 查询</button></div>

    </div>
    <div class="row" style="margin-top:20px;margin-left:1px;">
        <button class="btn btn-app " onclick="toEditDictInfo('add')" ><i class="fa fa-plus"></i> 添加</button>
        <button class="btn btn-app " onclick="toEditDictInfo('edit')" ><i class="fa fa-edit"></i> 编辑</button>
        <button class="btn btn-app " onclick="delDict()" ><i class="fa fa-trash"></i> 删除</button>
    </div>
</section>
<!-- Main content -->
 <section class="content">
<div class="col-md-12" style="margin-top:20px;">
	<div class="card">
        <div class="card-body p-0">
           <table class="table table-striped">
               <thead>
                <tr>
                  <th><input type="checkbox" id="allItem" name="allItem" value=""/></th>
                  <th style='text-align:center;'>类型</th>
                  <th style='text-align:center;'>名称</th>
				  <th style='text-align:center;'>值</th>

                </tr>
                </thead>
              <tbody id="tableBody">

             </tbody>
           </table>

         </div><!-- /.card-body -->
    </div>
    <div id="example2_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
            <div class="row">
                <div class="col-2">
                    <div class="dataTables_info" id="userListTable_info" role="status" aria-live="polite"></div>
                </div>
                <div class="col-1">
                    <div class="dataTables_info" id="div_pageSize" role="status" aria-live="polite"></div>
                </div>
                <div class="col-2">
                    <div class="dataTables_info input-group" id="div_button" role="status" aria-live="polite"></div>
                </div>
                <div class="col-7" style="margin-top: 8px;">
                    <div class="dataTables_paginate" id="userListTable_paginate">
                    <ul class="pagination" id="page"></ul>
                    </div>
                </div>
            </div>
     </div>
</div>
 </section>
<!-- 编辑好友信息 -->
<div class="modal fade" id="dictInfoModal" style="width:100%">
  <div class="modal-dialog">
    <div class="modal-content">

        <div class="row">
          <!-- left column -->
          <div class="col-md-12">
           <div class="card card-primary"  >
              <div class="card-header">
                <h3 class="card-title">编辑字典信息</h3>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <form role="form" id="form1">
                  <input type="hidden" id="seq">
                <div class="card-body">
                  <div class="input-group" >
                    <div class="col-md-2">
                    <label for="type" style="margin-top:7px;">类型<span style="color:red"> * </span></label>&nbsp;
                     </div>
                    <div class="col-md-10">
                    <input type="text" class="form-control" id="type" placeholder="请输入类型">
                    </div>
                  </div>

                  <div class="input-group" >
                    <div class="col-md-2">
                    <label for="name" style="margin-top:7px;">名称<span style="color:red"> * </span></label>&nbsp;
                     </div>
                    <div class="col-md-10">
                    <input type="text" class="form-control" id="name" placeholder="请输入名称">
                    </div>
                  </div>

                  <div class="input-group" >
                    <div class="col-md-2">
                    <label for="value" style="margin-top:7px;">值<span style="color:red"> * </span></label>&nbsp;
                     </div>
                    <div class="col-md-10">
                    <input type="email" class="form-control" id="value" placeholder="请输入值">
                    </div>
                  </div>


                  </select>
                </div>

                <!-- /.card-body -->

                <div class="card-footer">
                  <div align="right" >
                      <button type="button"  onclick="saveEditDictInfo()"  class="btn btn-primary">保存</button>
                      <button type="button" class="btn btn-info" onclick="cancelEditInfo()">取消</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>

</body>
<!-- ./wrapper -->
<!-- jQuery -->
<script src="/static/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables -->
<script src="/static/plugins/datatables/jquery.dataTables.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap4.js"></script>
<!-- SlimScroll -->
<script src="/static/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="/static/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="/static/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="/static/dist/js/demo.js"></script>
<script src="/static/plugins/iCheck/icheck.min.js"></script>
<!-- page script -->
<script src="/static/page.js"></script>
<!--<script src="/static/dist/js/bootstrap-tagsinput.js"></script>-->
<script src="/static/js/common.js"></script>
<!-- Select2 -->
<script src="/static/plugins/select2/select2.full.min.js"></script>

<script type="text/javascript" src="/static/tooltipster/tooltipster.bundle.min.js"></script>

<script src="/static/plugins/jquery/jquery.cookie.js"></script>
<script src="/static/layer/layer.js"></script>
<script>
    $(function () {
         init(1);
      }
    );

    function init(pageIndex){
        var pageSize = $("#pageSize_value").val();
        pageSize=filterNull(pageSize,5)
        $.ajax({
        type: 'get',
        url: '/WXCRM/dictData',
        data: {"type":"getDictList",
                "pageIndex": pageIndex,
                "pageSize": pageSize,
                "typeSearch":$("#typeSearch").val(),
                "nameSearch":$("#nameSearch").val(),
                "valueSearch":$("#valueSearch").val()
        },
        success: function (res) {
            severcheck(res);
            res = parseJson(res);
            var list = res.pageList;
            var count=res.count;
            var tableHead = "", html = "",temp="";
            $("#tableBody").empty();
            if(list!=null&&list.length>0) {
                for (var i = 0; i < list.length; i++) {
                        temp += "<tr id='"+list[i][0]+"'><td ><input type='checkbox' class='minimal' name='dictItem'  value='"+list[i][0]+"'/></td>";
                        temp += "<td style='text-align:center;'>" + filterNull(list[i][1],"") + "</td>";//类型
                        temp += "<td style='text-align:center;'><span class='js-title' title='"+list[i][2]+"' style='display:inline-block;width:200px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;'>"+ filterNull(list[i][2],"")+"</span></td>";//名称
                        temp += "<td style='text-align:center;'>" + filterNull(list[i][3],"") + "</td>";//值
                        temp +=  "</tr>";//操作
                }
            $("#tableBody").append(temp);

			$('.js-title').tooltipster();

            $(("[type='checkbox']")).iCheck({
                checkboxClass : 'icheckbox_square-blue',
                radioClass: 'iradio_square-blue'
            });

            //全选
            $('#allItem').on('ifChecked', function(event){
                $("input").iCheck('check');
            });
            //反选
            $('#allItem').on('ifUnchecked', function(event){
                $("input").iCheck('uncheck');
            });

             var pages=Math.ceil(count/pageSize);
             page={'total':count,'pageNum':pageIndex,'pages':pages};
             setPage(page,"init","show");


            }
        }
     });
    }
    function toEditDictInfo(editType){
        if(editType=='add'){
            clearEditInfo();
        }else{
            var selectItems= $("input:checkbox[name='dictItem']:checked");
            if(selectItems.length!=1){
                alert("请选择唯一的一条数据后，再进行编辑");
                return;
            }
            var id=selectItems.val()
            var itemTr=$("#"+id);
            $("#seq").val(id);
            $("#type").val(itemTr.children("td").eq(1).text());
            $("#name").val(itemTr.children("td").eq(2).text());
            $("#value").val(itemTr.children("td").eq(3).text());
        }
         $("#dictInfoModal").modal("show");
    }
function clearEditInfo(){
        $("#seq").val('');
        $("#type").val('');
        $("#name").val('');
        $("#value").val('');
}
function saveEditDictInfo(){
    var seq=$("#seq").val();
    var name=$("#name").val().trim();
    var value=$("#value").val().trim();
    var dictType=$("#type").val().trim();
    if(!name||!value||!dictType){
        alert("请完善必填信息！")
        return;
    }
    $.ajax({
        type: 'POST',
        traditional:true,//传递数组
        url: '/WXCRM/dictData/',
        data: {"type":"saveDictInfo",
                "seq":$("#seq").val(),
                "name":$("#name").val(),
                "value":$("#value").val(),
                "dictType":$("#type").val()
        },
        success: function (res) {
            severcheck(res);
            res = parseJson(res);
             var result=res.result;
             if(result==1){
                init(1);
                $("#dictInfoModal").modal("hide");
                clearEditInfo();
             }else{
                 alert('保存失败')
             }
        }
        });
}

function  cancelEditInfo() {
        $("#dictInfoModal").modal("hide");
        clearEditInfo();
}

function delDict() {

        if (!$("input[type='checkbox']").is(':checked')) {
            alert("请选择要删除的条目！");
            return;
        }else{
            var msg = "您确定要删除吗？\n\n请确认！";
            if (confirm(msg)!=true){
                return ;
            }
        }
        var itemIds = '';
        var selectItems= $("input:checkbox[name='dictItem']:checked");
        selectItems.each(function (k) {
            if (k == 0) {
                itemIds = $(this).val();
            } else {
                itemIds += ',' + $(this).val();
            }
        })
        $.ajax({
            type: "POST",
            url:  '/WXCRM/dictData/',
            headers: {"X-CSRFToken": $.cookie('csrftoken')},
            data: {"type":"delDictInfo","itemIds": itemIds},
            success: function (res) {
                severcheck(res);
                res = parseJson(res);
                var result=res.result;
                if (result == 1) {
                    alert("删除成功！");
                    init(1);
                    return;
                }
            },
            error: function () {
                alert('删除失败！')
            }
        });
    }
</script>

</body>
</html>
