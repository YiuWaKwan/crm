<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>当前好友关系列表</title>
    <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="/static/dist/css/ionicons.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap4.css">


  <link rel="stylesheet" href="/static/plugins/iCheck/all.css">

  <!-- Select2 -->
  <link rel="stylesheet" href="/static/plugins/select2/select2.min.css">

<link rel="stylesheet" href="/static/tooltipster/tooltipster.bundle.min.css" />
 <!-- 图片放大css-->
<link rel="stylesheet" href="/static/css/imgSize.css" />
  <!-- Theme style 放最下面，否则有些插件显示样式会不统一-->
  <link rel="stylesheet" href="/static/dist/css/adminlte.min.css">
</head>
<body class="hold-transition sidebar-mini">

<!-- Main content -->
 <section class="content">
<div class="col-md-12" style="margin-top:20px;">
	<div class="card">
        <div class="card-body p-0">
            <input type="hidden" id="wxId">
           <table class="table table-striped">
               <thead>
                <tr>
                  <th style='text-align:center;'>主号</th>
                  <th style='text-align:center;'>好友号</th>
				  <th style='text-align:center;'>添加时间</th>
				  <th style='text-align:center;'>添加方式</th>
				  <th style='text-align:center;'>状态</th>
				  <th style='text-align:center;'>来源</th>
				  <th style='text-align:center;'>备注</th>
				  <th style='text-align:center;'>最近联系时间</th>
                </tr>
                </thead>
              <tbody id="tableBody">

             </tbody>
           </table>

         </div><!-- /.card-body -->
    </div>
    <div id="example2_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
            <div class="row">
                <div class="col-2">
                    <div class="dataTables_info" id="userListTable_info" role="status" aria-live="polite"></div>
                </div>
                <div class="col-1">
                    <div class="dataTables_info" id="div_pageSize" role="status" aria-live="polite"></div>
                </div>
                <div class="col-2">
                    <div class="dataTables_info input-group" id="div_button" role="status" aria-live="polite"></div>
                </div>
                <div class="col-7" style="margin-top: 8px;">
                    <div class="dataTables_paginate" id="userListTable_paginate">
                    <ul class="pagination" id="page"></ul>
                    </div>
                </div>
            </div>
     </div>
</div>
 </section>


</body>
<!-- ./wrapper -->
<!-- jQuery -->
<script src="/static/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables -->
<script src="/static/plugins/datatables/jquery.dataTables.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap4.js"></script>
<!-- SlimScroll -->
<script src="/static/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="/static/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="/static/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="/static/dist/js/demo.js"></script>
<script src="/static/plugins/iCheck/icheck.min.js"></script>
<!-- page script -->
<script src="/static/page.js"></script>
<!--<script src="/static/dist/js/bootstrap-tagsinput.js"></script>-->
<script src="/static/js/common.js"></script>
<!-- Select2 -->
<script src="/static/plugins/select2/select2.full.min.js"></script>

<script type="text/javascript" src="/static/tooltipster/tooltipster.bundle.min.js"></script>

<script src="/static/plugins/jquery/jquery.cookie.js"></script>
<script>
    $(function () {
        $("#wxId").val('{{ wxId }}');
         init(1);
      }

    );

    function init(pageIndex){
        var pageSize = $("#pageSize_value").val();
        pageSize=filterNull(pageSize,5)
        $.ajax({
        type: 'get',
        url: '/WXCRM/friendData',
        data: {"type":"getFriendMainIdList",
                "pageIndex": pageIndex,
                "pageSize": pageSize,
                "wxId":$("#wxId").val()
        },
        success: function (res) {
            severcheck(res);
            res = parseJson(res);
            var list = res.pageList;
            var count=res.count;
            var temp="";
            $("#tableBody").empty();
            if(list!=null&&list.length>0) {
                for (var i = 0; i < list.length; i++) {
                        var state=filterNull(list[i][4],1)
                        var stateClass="btn btn-block btn-success btn-sm"; //1-正常
                        if(state==2){//2-拉黑
                            stateClass="btn btn-block btn-danger btn-sm";
                        }
                        var lastChatTime=filterNull(list[i][6],"");
                        if(lastChatTime!=""){
                            lastChatTime=new Date(lastChatTime).format("yyyy-MM-dd");
                        }
                        var addTime=filterNull(list[i][2],"");
                        if(addTime!=""){
                            addTime=new Date(addTime).format("yyyy-MM-dd");
                        }
                        temp += "<tr><td style='text-align:center;'>" + list[i][0] + "</td>";//主号
                        temp += "<td style='text-align:center;'>" + list[i][1] + "</td>";//好友号
                        temp += "<td style='text-align:center;'>" + addTime + "</td>";//添加时间
                        temp += "<td style='text-align:center;'>" + filterNull(list[i][8],"主动") + "</td>";//添加方式
                        temp += "<td style='text-align:center;' width='70px'><button  type='button' class='"+stateClass+"'>" + filterNull(list[i][7],"正常") + "</button></td>";//状态
                        temp += "<td style='text-align:center;'>" + filterNull(list[i][5],"") + "</td>";//来源
                        temp += "<td style='text-align:center;'>" + filterNull(list[i][10],"") + "</td>";//备注
                        temp += "<td style='text-align:center;'><span class='js-title' title='"+list[i][6]+"' style='display:inline-block;width:100px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;'>"+ lastChatTime+"</span></td>";//最近联系时间
                        temp +=  "</tr>";//操作
                }

            $("#tableBody").append(temp);

			$('.js-title').tooltipster();
            }

             var pages=Math.ceil(count/pageSize);
             page={'total':count,'pageNum':pageIndex,'pages':pages};
             setPage(page,"init","show");
        }
     });
    }


</script>

</body>
</html>