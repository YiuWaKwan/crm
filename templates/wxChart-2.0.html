<html lang="zh_CN">
<head>
	<script>window.synccheck={retcode:"1101",selector:"0"}</script>
	<style type="text/css">
		[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}
	</style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>慧聊客服聊天</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/static/js/jQuery/jquery-2.2.3.min.js"></script>
    <script src="/static/js/angular-1.7.0/angular.min.js"></script>
    <script src="/static/js/angular-ui-router/angular-ui-router.min.js"></script>
    <script src="/static/js/angular-1.7.0/angular-sanitize.min.js"></script>
    <script src="/static/js/angular-1.7.0/angular-animate.min.js"></script>
    <script src="/static/js/angular-1.7.0/angular-websocket.js"></script>
    <script src="/static/js/jQuery/jquery.ui.widget.js"></script>
    <script src="/static/js/jQuery/jquery.fileupload.js"></script>
    <!-- Select2 -->
    <script src="/static/plugins/select2/select2.full.min.js"></script>
    <script type="text/javascript">if(window.top!== window.self){top.location=self.location;}</script>
    <link rel="shortcut icon" href="/static/img/wx/shortcut.ico" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="/static/img/wx/qMUjOdv.png" type="image/png">
    <link rel="icon" sizes="128x128" href="/static/img/wx/2kAS7mD.png" type="image/png">
    <link rel="apple-touch-icon" sizes="128x128" href="/static/img/wx/2kAS7mD.png" type="image/png">
    <link rel="stylesheet" href="/static/plugins/select2/select2.min.css">
    <link rel="stylesheet" href="/static/css/wx-2.0.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="/static/dist/css/ionicons.min.css">
    <link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap4.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/plugins/iCheck/all.css">
    <style id="style-1-cropbar-clipper">

    </style>
</head>
<body draggable="false" mm-action-track="" track-type="resize" ng-app="appWx" ng-controller="appController" ng-class="{loaded:isLoaded,unlogin:isUnLogin}" ng-click="appClick($event);" class="ng-scope ng-isolate-scope loaded">
<canvas style="position:absolute;top:0;left:0;bottom:0;right:0;z-index:-1;width:100%;height:100%;" id="heroCanvas"></canvas>
<!--BEGIN main-->
<audio id="msgNoticePlayer" preload="auto" hidden="true"><source src="/static/voices/msg.mp3" type="audio/mpeg"></audio>
<audio id="voiceMsgPlayer" preload="auto" hidden="true"><source src="" type="audio/mpeg"></audio>
<div class="main">
    <div class="header_inner">
        <div class="right_header_inner" style="">
            <span>{{ request.session.oper_name }}</span><span><a herf="#" onclick="javascript:window.opener=null;window.open('','_self');window.close();">退出</a></span>
        </div>
    </div>
    <div class="header_line"></div>
    <div class="main_inner">
        <!--BEGIN panel-->
        <div class="panel_right">
            <div class="panel_menu" style="width: auto;">
                <!--END BEGIN view-->
                <div class="group_view" style="width: auto;" ng-init="showTab = 'tab_khxx'">
                    <!--BEGIN contact list-->
                    <div class="contact_list" style="position: relative; margin: 0px; height: 100%; overflow: hidden;text-align: center;">
                        <!--BEGIN star contact list-->
                        <div style="display:inline-block;" title="客户信息" ng-class="{'active': showTab ==='tab_khxx'}" ng-click="showTab = 'tab_khxx'">
                            <div class="chat_item_group slide-left" >
                                <div class="avatar" style="margin-right: 0;">
                                    <i class="fa">客户信息</i>
                                </div>
                            </div>
                        </div>
                        <div style="display:inline-block;" title="快捷回复" ng-class="{'active': showTab ==='tab_kjhf'}" ng-click="showTab = 'tab_kjhf'">
                            <div class="chat_item_group slide-left">
                                <div class="avatar" style="margin-right: 0;">
                                    <i class="fa">快捷回复</i>
                                </div>
                            </div>
                        </div>
                        <div ng-show="showKnowledge" style="display:inline-block;" title="知识库" ng-class="{'active': showTab ==='tab_zsk'}" ng-click="showTab = 'tab_zsk'">
                            <div class="chat_item_group slide-left">
                                <div class="avatar" style="margin-right: 0;">
                                    <i class="fa">知识库</i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--END contact list-->
                </div>
                <!--END nav view-->
            </div>
            <div class="tab_main" ng-show="showTab ==='tab_khxx'">
                <div ng-if="groupInfo && groupInfo.group_id">
                    <div class="headshot">
                        <p><img class="img" src="[[groupInfo.head_picture?groupInfo.head_picture:'\\static\\img\\qun.jpg']]" mm-src="[[groupInfo.head_picture?groupInfo.head_picture:'\\static\\img\\qun.jpg']]"></p>
                        <p><span class="display_name" ng-bind-html="groupInfo.group_name"></span></p>
                    </div>
                    <div class="custom_info">
                        <p><span>创建时间：</span><span ng-bind-html="groupInfo.create_date"></span></p>
                        <p><span>描述：</span><span ng-bind-html="groupInfo.description"></span></p>
                    </div>
                </div>
                <div ng-if="(!groupInfo || !groupInfo.group_id) && (customInfo && customInfo.NickName)">
                    <div class="headshot">
                        <p><img class="img" src="[[customInfo.pic?customInfo.pic:'\\static\\img\\wx\\icon_man.png']]" mm-src="[[customInfo.pic?customInfo.pic:'\\static\\img\\wx\\icon_man.png']]"></p>
                        <p><span class="display_name" ng-bind-html="customInfo.NickName"></span></p>
                        <p style="color: #293037;font-size: 12px;opacity:0.7;font-weight:400;">呢称：<span ng-bind-html="customInfo.remarkName"></span></p>
                    </div>
                    <div class="custom_title">
                        <span class="">个人信息</span>
                        <span ng-if="currentContact.isGroup == 1"><a class="btn_edit" href="javascript:editMemberInfo([[groupMemberInfoExt]],[[groupMemberFlags]]);">编辑</a></span>
                    </div>
                    <div class="custom_info">
                        {% comment %}<p><span>电话：</span><span ng-bind-html="customInfo.phone"></span></p>{% endcomment %}
                        <p><span>姓名：</span><span ng-bind-html="customInfo.remarkName"></span></p>
                        <p><span>性别：</span><span ng-bind-html="customInfo.sex"></span></p>
                        <p><span>生日：</span><span ng-bind-html="customInfo.birthday"></span></p>
                        <p><span>地区：</span><span ng-bind-html="customInfo.zone"></span></p>
                        <p><span>地址：</span><span ng-bind-html="customInfo.address"></span></p>
    {#                    <p><span>咨询次数：</span><span ng-bind-html="customInfo.consultCount"></span></p>#}
    {#                    <p><span>最近咨询时间：</span><span ng-bind-html="customInfo.consultLatestTime"></span></p>#}
                        <div class="custom_flag_block"><span>标签：</span>
                            <div class="custom_flag">
                                <div ng-repeat="flag in customInfo.flags">[[flag.flagName]]<span ng-show="false" ng-click="delFlag(flag.flagValue)" class="del"></span></div>
                                <div ng-show="false" class="add">标签</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div  ng-if="(!groupInfo || !groupInfo.group_id) && (!customInfo || !customInfo.NickName)">
                    <div style="margin-top: 130px;text-align: center;">
                        <img src="/static/img/wx/img_quesheng.png">
                        <span style="font-size:18px;color: #B2B2B2;margin-top: 25px;margin-top:45px;display: inline-block;">您还未选择好友~</span>
                    </div>
                </div>
            </div>
            <div class="tab_main" ng-show="showTab ==='tab_kjhf'">
                <!--BEGIN search-->
                <div class="search_bar" id="search_bar_quickMsg">
                    <i class="web_wechat_search"></i>
                    <input class="frm_search" type="text" ng-model="keywordQuickReply" ng-keypress="($event.which === 13)?searchMsg():0" ng-blur="foucs = false" ng-focus="foucs = true" placeholder="请输入关键字">
                    <button ng-click="searchMsg()">查找</button>
                </div>
                <!--END search-->
                <div style="height: calc(100% - 80px);overflow: auto;">
                    <div class="quickMsg" ng-class="{'active': chooseQuickReply == item.content}" ng-click="goQuickReply(item.content)" ng-repeat="(itemInedx,item) in quickReplyList | filter:{content:keywordQuickReplyFilter} ">
                        <span class="msgText" ng-attr-title="[[quickReplyList[itemInedx].content]]" ng-bind-html="item.content"></span>
                        <span class="msgChoose">选择</span>
                    </div>
                </div>
            </div>
            <div class="tab_main" ng-show="showTab ==='tab_zsk'">正在开发中</div>
        </div>
        <div class="panel_left">
            <div class="panel_menu">
                <!--BEGIN nav view-->
                <div class="group_view" style="width: auto;">
                    <!--BEGIN contact list-->
                    <div class="contact_list" style="position: relative; margin: 0px; height: 100%; overflow: hidden;text-align: center;">
                        <!--BEGIN star contact list-->
                        <div style="display:inline-block;" title="好友列表" ng-class="{'active': showPanel ==='panel_wx'}" ng-click="clickMenu('panel_wx')">
                            <div class="chat_item_group slide-left" >
                                <div class="avatar" style="margin-right: 0;">
                                    <i class="fa {% comment %}fa-weixin{% endcomment %}">全部聊天</i>
                                    <i class="icon web_wechat_reddot_middle" style="" ng-show="totalCount > 0" ng-bind-html="totalCount>99?'...':totalCount"></i>
                                </div>
                            </div>
                        </div>
                        <div style="display:inline-block;" title="@我的消息" ng-class="{'active': showPanel ==='panel_at'}" ng-click="clickMenu('panel_at')">
                            <div class="chat_item_group slide-left">
                                <div class="avatar" style="margin-right: 0;">
                                    <i class="fa {% comment %}fa-commenting-o{% endcomment %}">@我的</i>
                                    <i class="icon web_wechat_reddot_middle" style="" ng-show="groupChatAtCount > 0" ng-bind-html="groupChatAtCount>99?'...':groupChatAtCount"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--END contact list-->
                </div>
                <!--END nav view-->
            </div>
            <div class="panel_wx" ng-show="showPanel ==='panel_wx'">
                <div class="group_view" style="width: auto;top: -8px;">
                    <!--BEGIN contact list-->
                    <div class="contact_list" style="position: relative; margin-bottom: 0px; margin-right: 0px; height: 98%; overflow-x: hidden; overflow-y: scroll;">
                        <!--BEGIN star contact list-->
                        <div>
                            <div class="top-placeholder" style="height: 0px;"></div>
                            <div ng-repeat="wx in wxInfos" ng-class="{'active': choose_wx_index == $index}">
                                <div class="chat_item slide-left" ng-click="chooseWx(wx,$index)" ng-init="$index===0?chooseWx(wx,0):''">
                                    <div id="moreTools" ng-click="showMainWxMenu($event,wx)" title="更多功能" style="color: rgb(102, 107, 112);font-weight:900;font-size: 15px;width: 10%;overflow: hidden;margin:5px 0px 0px 150px;position: absolute;">…</div>
                                    <div class="avatar">
                                        <img class="img lazy" src="[[wx.pic]]" mm-src="[[wx.pic_big]]">
                                        <i class="icon web_wechat_reddot_middle" style="" ng-if="wx.NoticeCount>0" ng-bind-html="wx.NoticeCount>99?'...':wx.NoticeCount"></i>
                                    </div>
                                    <div class="info">
                                        <h4 class="nickname" ng-bind-html="wx.NickName"></h4>
{#                                        <h4 class="nickname" ng-bind-html="wx.wx_login_id"></h4>#}
                                    </div>
                                </div>
                            </div>
                            <div class="bottom-placeholder" style="height: 0px;"></div>
                        </div>
                    </div>
                    <!--END contact list-->
                </div>
                <!--END nav view-->
            </div>
            <div class="panel_wx" ng-show="showPanel ==='panel_at'">
                <div class="group_view" style="width: auto;top: -8px;">
                    <!--BEGIN contact list-->
                    <div class="contact_list" style="position: relative; margin-bottom: 0px; margin-right: 0px; height: 98%; overflow-x: hidden; overflow-y: scroll;">
                        <!--BEGIN star contact list-->
                        <div >
                            <div class="top-placeholder" style="height: 0px;"></div>
                            <div ng-repeat="(wxKey,wxValue) in wxInfosAt" ng-class="{'active': choose_at_index == $index}">
                                <div class="chat_item slide-left" ng-click="chooseWxAt(wxValue,$index)" ng-init="$index===0?chooseWxAt(wxValue,0):''">
                                    <div class="avatar">
                                        <img class="img lazy" src="[[wxValue.pic]]" mm-src="[[wxValue.pic_big]]">
                                        <i class="icon web_wechat_reddot_middle" style="" ng-if="wxValue.NoticeCount>0" ng-bind-html="wxValue.NoticeCount>99?'...':wxValue.NoticeCount"></i>
                                    </div>
                                    <div class="info">
                                        <h4 class="nickname" ng-bind-html="wxValue.NickName"></h4>
{#                                        <h4 class="nickname" ng-bind-html="wxValue.wx_login_id"></h4>#}
                                    </div>
                                </div>
                            </div>
                            <div class="bottom-placeholder" style="height: 0px;"></div>
                        </div>
                    </div>
                    <!--END contact list-->
                </div>
                <!--END nav view-->
            </div>
        </div>

        <div class="panel_hy" ng-show="showPanel === 'panel_wx'">
            <input type="hidden" id="wx_main_id" value="[[account.wx_id]]">
            <!--BEGIN header-->
            <div class="header">
                <div class="avatar">
                    <img class="img" src="[[account.pic]]" mm-src="[[account.pic_big]]" ng-click="showProfile($event,account)">
                </div>
                <div class="info">
                    <h3 class="nickname">
                        <span class="display_name" ng-bind-html="account.NickName"></span>
                    </h3>
                </div>
            </div>
            <!--END header-->

            <!--BEGIN search-->
            <div class="search_bar" id="search_bar">
                <i class="web_wechat_search"></i>
                <input class="frm_search" type="text" ng-model="keyword" ng-keyup="searchKeyup()" ng-blur="foucs = false" ng-focus="foucs = true" placeholder="搜索微信好友">
                <div id="mmpop_search" ui-view="searchList" class="mmpop recommendation" tabindex="-1"></div>
            </div>
            <!--END search-->

            <!--BEGIN tab-->
            <div class="tab" style="padding: 5px 0px 10px;border-bottom: 1px solid rgba(0,0,0,0.1);" ng-class="{no_reader: true}">
                <div class="tab_item">
                    <a class="chat" ui-sref="chat" ng-click="clickChat('chat')" title="聊天" href="#"><i class="web_wechat_tab_chat web_wechat_tab_chat_hl" ng-class="{web_wechat_tab_chat_hl: state_current_name ==='chat'}"></i></a>
                </div>
                <div class="tab_item no_extra">
                    <a class="chat" ui-sref="contact" ng-click="clickChat('contact')" title="通讯录" href="#"><i class="web_wechat_tab_friends" ng-class="{web_wechat_tab_friends_hl: state_current_name ==='contact'}"></i></a>
                </div>
            </div>
            <!--END tab-->

            <!--BEGIN nav view-->
            <!-- uiView: navView -->
            <div ui-view="navView" id="navView" class="ng-scope"></div>

            <div class="nav_view" ng-style="{visibility:state_current_name ==='chat'?'visible':'hidden',width:state_current_name ==='chat'?'auto':'0'}" nav-chat-directive="" style="visibility: visible; width: auto;top: 172px;animation:to205 0.5s 1;-webkit-animation:to205 0.5s 1;">
            <!--BEGIN chat list-->
                <div class="chat_list" style="position: relative;">
                    <div class="chat_list" id="J_NavChatScrollBody" data-username=""
                         style="margin-bottom: 0px; margin-right: 0px; height: 98%; overflow-x: hidden; overflow-y: scroll;background: #ffffff">
                        <p class="ico_loading ng-hide" ng-hide="chatList.length &gt; 0">
                            <img style="width: 40px;" src="/static/img/wx/load.gif" alt="">正在获取最近的聊天...
                        </p>

                        <div data-no-cache="true" data-height="64" data-buffer-height="200">
                            <div class="top-placeholder" style="height: 0px;"></div>

                            <div class="chat_item_contact" ng-repeat="chatContact in chatList |orderBy:['-isTop','-SendMin','NickName']">
                                <div ng-right-click="contextmenu(chatContact)" data-top='[[chatContact.isTop]]' data-wxid='[[chatContact.wx_id]]' class="chat_item slide-left"
                                     ng-if="chatContact.NickName != '暂无列表'" ng-click="chatShow(chatContact,$index)" ng-class="{'active': (chatContact.NickName == currentContact.NickName),'top':chatContact.isTop}">

                                    <div class="ext">
                                        <p class="attr">[[timeShow(chatContact.SendMin)]]</p>
                                    </div>
                                    <div class="avatar">
                                        <img class="img" src="[[chatContact.pic]]" mm-src="[[chatContact.pic_big]]">
                                        <i class="icon web_wechat_reddot_middle" ng-if="chatContact.NoticeCount" ng-bind-html="chatContact.NoticeCount>99?'...':chatContact.NoticeCount"></i>
                                    </div>

                                    <div class="info">
                                        <h3 class="nickname">
                                            <span class="nickname_text" ng-bind-html="chatContact.RemarkName"></span>
                                        </h3>
                                        <!-- 非当前会话 有草稿 -->
                                        <p class="msg" ng-if="chatContact.draft && chatContact.NickName != currentContact.NickName">
                                            <span style="color: red">[草稿]</span><span ng-bind-html="chatContact.draft | to_trusted"></span>
                                        </p>
                                        <!-- 非当前会话 无草稿-->
                                        <p class="msg" ng-if="!chatContact.draft && chatContact.LastChart && chatContact.NickName != currentContact.NickName">
                                            <span ng-bind-html="chatContact.LastChart"></span>
                                        </p>
                                        <!-- 当前会话 -->
                                        <p class="msg" ng-if="chatContact.LastChart && chatContact.NickName == currentContact.NickName">
                                            <span ng-bind-html="chatContact.LastChart"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="bottom-placeholder" style="height: 0px;"></div>
                        </div>
                    </div>
                    <div class="scroll-element scroll-y">
                        <div class="scroll-element_corner"></div>
                        <div class="scroll-arrow scroll-arrow_less"></div>
                        <div class="scroll-arrow scroll-arrow_more"></div>
                        <div class="scroll-element_outer">
                            <div class="scroll-element_size"></div>
                            <div class="scroll-element_inner-wrapper">
                                <div class="scroll-element_inner scroll-element_track">
                                    <div class="scroll-element_inner-bottom"></div>
                                </div>
                            </div>
                            <div class="scroll-bar" style="height: 64px; top: 0px;">
                                <div class="scroll-bar_body">
                                    <div class="scroll-bar_body-inner"></div>
                                </div>
                                <div class="scroll-bar_bottom"></div>
                                <div class="scroll-bar_center"></div>
                            </div>
                        </div>
                    </div>
                </div>
            <!--END chat list-->
            </div>

            <div class="nav_view" ng-style="{visibility:state_current_name =='contact'?'visible':'hidden',width:state_current_name =='contact'?'auto':'0'}" nav-contact-directive="" style=" visibility: visible; width: auto;">
            <!--BEGIN contact list-->
            <div class="contact_list" style="position: relative;">
                <div id="navContact" style="margin-bottom: 0px; margin-right: 0px; height: 98%; overflow-x: hidden; overflow-y: scroll;">
                <!--BEGIN star contact list-->
                    <div data-no-cache="true" data-height-calc="heightCalc" data-buffer-height="100">
                        <div ng-style="{height:topHeight}" class="top-placeholder" style="height: 0px;"></div>
                        <div ng-repeat="item in allContacts">
                            <h4 ng-if="item.type=='header'" class="contact_title" ng-bind-html="item.NickName"></h4>
                            <div class="chat_item_contact" ng-if="item.type!='header'" ng-click="contactShow(item)" ng-class="{'active':currentUserName == item.NickName}">
                                <div class="contact_item">
                                    <div class="avatar">
                                        <img class="img lazy" src="[[item.pic]]" mm-src="[[item.pic_big]]">
                                    </div>
                                    <div class="info">
                                        <h4 class="nickname" ng-bind-html="item.RemarkName"></h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div ng-style="{height:bottomHeight}" class="bottom-placeholder"></div>
                    </div>
                </div>
                <div class="scroll-element scroll-y scroll-scrollx_visible scroll-scrolly_visible">
                    <div class="scroll-element_corner"></div>
                    <div class="scroll-arrow scroll-arrow_less"></div>
                    <div class="scroll-arrow scroll-arrow_more"></div>
                    <div class="scroll-element_outer">
                        <div class="scroll-element_size"></div>
                        <div class="scroll-element_inner-wrapper">
                            <div class="scroll-element_inner scroll-element_track">
                                <div class="scroll-element_inner-bottom"></div>
                            </div>
                        </div>
                        <div class="scroll-bar" style="height: 10px; top: 0px;">
                            <div class="scroll-bar_body">
                                <div class="scroll-bar_body-inner"></div>
                            </div>
                            <div class="scroll-bar_bottom"></div>
                            <div class="scroll-bar_center"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!--END contact list-->
        </div>
            <!--END nav view-->
        </div>
        <div class="panel_hy" ng-show="showPanel === 'panel_at'">
            <input type="hidden" id="wx_main_id" value="[[account.wx_id]]">

            <!--BEGIN search-->
            <div class="search_bar" id="search_bar" style="margin: 22px auto 22px">
                <i class="web_wechat_search"></i>
                <input class="frm_search" type="text" ng-model="keyword" ng-keyup="searchKeyup()" ng-blur="foucs = false" ng-focus="foucs = true" placeholder="搜索微信好友">
                <div id="mmpop_search" ui-view="searchList" class="mmpop recommendation" tabindex="-1"></div>
            </div>
            <!--END search-->

            <!--BEGIN nav view-->
            <!-- uiView: navView -->
            <div ui-view="navView" id="navView" class="ng-scope"></div>

            <div class="nav_view" ng-style="{visibility:state_current_name ==='chat'?'visible':'hidden',width:state_current_name ==='chat'?'auto':'0'}" nav-chat-directive="" style="visibility: visible; width: auto;top: 80px;animation:to80 0.3s 1;-webkit-animation:to80 0.3s 1;">
            <!--BEGIN chat list-->
                <div class="chat_list" style="position: relative;">
                    <div class="chat_list" id="J_NavChatScrollBody" data-username=""
                         style="margin-bottom: 0px; margin-right: 0px; height: 98%; overflow-x: hidden; overflow-y: scroll;">
                        <p class="ico_loading ng-hide" ng-hide="chatListAt.length &gt; 0">
                            <img style="width: 40px;" src="/static/img/wx/load.gif" alt="">正在获取最近的聊天...
                        </p>

                        <div data-no-cache="true" data-height="64" data-buffer-height="200">
                            <div class="top-placeholder" style="height: 0px;"></div>

                            <div class="chat_item_contact" ng-repeat="chatContact in chatListAt |orderBy:['-isTop','-SendMin','NickName']" title="[[chatContact.NickName]]">
                                <div {% comment %}ng-right-click="contextmenu(chatContact)"{% endcomment %} data-top='[[chatContact.isTop]]' data-wxid='[[chatContact.wx_id]]' class="chat_item slide-left"
                                     ng-if="chatContact.NickName != '暂无列表'" ng-click="chatShow(chatContact,$index)" ng-class="{'active': (chatContact.NickName == currentContact.NickName && chatContact.memberId == currentContact.memberId),'top':chatContact.isTop}">

                                    <div class="ext">
                                        <p class="attr">[[timeShow(chatContact.SendMin)]]</p>
                                    </div>
                                    <div class="avatar">
                                        <img class="img" src="[[chatContact.pic]]" mm-src="[[chatContact.pic_big]]">
                                        <i class="icon web_wechat_reddot_middle" ng-if="chatContact.NoticeCount" ng-bind-html="chatContact.NoticeCount>99?'...':chatContact.NoticeCount"></i>
                                    </div>

                                    <div class="info">
                                        <h3 class="nickname">
                                            <span class="nickname_text" ng-bind-html="chatContact.RemarkName"></span>
                                        </h3>
                                        <!-- 非当前会话 有草稿 -->
                                        <p class="msg" ng-if="chatContact.draft && chatContact.NickName != currentContact.NickName">
                                            <span style="color: red">[草稿]</span><span ng-bind-html="chatContact.draft | to_trusted"></span>
                                        </p>
                                        <!-- 非当前会话 无草稿-->
                                        <p class="msg" ng-if="!chatContact.draft && chatContact.LastChart && chatContact.NickName != currentContact.NickName">
                                            <span ng-bind-html="chatContact.LastChart"></span>
                                        </p>
                                        <!-- 当前会话 -->
                                        <p class="msg" ng-if="chatContact.LastChart && chatContact.NickName == currentContact.NickName">
                                            <span ng-bind-html="chatContact.LastChart"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="bottom-placeholder" style="height: 0px;"></div>
                        </div>
                    </div>
                    <div class="scroll-element scroll-y">
                        <div class="scroll-element_corner"></div>
                        <div class="scroll-arrow scroll-arrow_less"></div>
                        <div class="scroll-arrow scroll-arrow_more"></div>
                        <div class="scroll-element_outer">
                            <div class="scroll-element_size"></div>
                            <div class="scroll-element_inner-wrapper">
                                <div class="scroll-element_inner scroll-element_track">
                                    <div class="scroll-element_inner-bottom"></div>
                                </div>
                            </div>
                            <div class="scroll-bar" style="height: 64px; top: 0px;">
                                <div class="scroll-bar_body">
                                    <div class="scroll-bar_body-inner"></div>
                                </div>
                                <div class="scroll-bar_bottom"></div>
                                <div class="scroll-bar_center"></div>
                            </div>
                        </div>
                    </div>
                </div>
            <!--END chat list-->
            </div>
            <!--END nav view-->
        </div>
        <!--END panel-->

        <!-- uiView: contentView 聊天窗口容器-->
        <div ui-view="contentView" style="height:100%;"></div>
        <!-- 右键菜单 -->
        <div id="contextMenu" class="dropdown contextMenu open" ng-show="contextMenuFlag.isShowContextMenu" ng-style="contextStyle">
            <ul class='dropdown_menu'>
                <li><a ng-if="contextMenuFlag.is_friend" ng-click="showDialog('remark_dialog')" style=''>设置备注</a></li>
                <li ng-if="(contextMenuFlag.is_friend || contextMenuFlag.is_group) && (contextMenuFlag.is_top == false)"><a ng-click="modifyWx('setTop',contextMenuFlag.menu_wx_id)" style=''>置顶</a></li>
                <li ng-if="(contextMenuFlag.is_friend || contextMenuFlag.is_group) && contextMenuFlag.is_top"><a ng-click="modifyWx('cancelTop',contextMenuFlag.menu_wx_id)" style=''>取消置顶</a></li>
                <li><a ng-show="contextMenuFlag.is_friend" ng-click="modifyWx('closeChat',contextMenuFlag.menu_wx_id)" style=''>关闭聊天</a></li>
                <li><a ng-show="contextMenuFlag.is_friend" ng-click="showDialog('setflag')" style=''>客户标注</a></li>
                <li><a ng-show="contextMenuFlag.is_group &&contextMenuFlag.groupOwnerId==account.wx_id" ng-click="showDialog('group_notice')" style=''>群公告</a></li>
                <li><a ng-show="contextMenuFlag.is_group && contextMenuFlag.isNotAtSession" ng-click="showDialog('group_wx_name')" style=''>群昵称</a></li>
                <li><a ng-show="contextMenuFlag.is_group && contextMenuFlag.isNotAtSession" ng-click="showDialog('add_member')" style=''>增加成员</a></li>
                <li><a ng-show="contextMenuFlag.is_group &&contextMenuFlag.groupOwnerId==account.wx_id" ng-click="showDialog('del_member')" style=''>删除成员</a></li>
                <li ng-if="contextMenuFlag.is_friend || contextMenuFlag.is_group"><a ng-click="modifyWx('flush_chat',contextMenuFlag.menu_wx_id)" style=''>刷新聊天记录</a></li>
                <li><a ng-if="contextMenuFlag.is_chat" ng-click="showDialog('transpond')" style=''>发送给朋友</a></li>
                <!--li><a ng-if="contextMenuFlag.is_chat" ng-click="showDialog('del_chat')" style='cursor:pointer'>删除</a></li-->
                <li><a ng-if="contextMenuFlag.is_head" ng-click="modifyWx('head', contextMenuFlag.menu_wx_id)" style=''>[[contextMenuFlag.headname]]</a></li>
                <li><a ng-if="contextMenuFlag.is_notice" ng-click="modifyWx('notice', contextMenuFlag.menu_wx_id)" style=''>删除@</a></li>
            </ul>
        </div>
    </div>
</div>

<!--END main-->
<div class="unknown_things">
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
        <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
</div>

<div id="profile_show">
    <div id="profile" ui-view="profile" class="mmpop profile_mini_wrap scale-fade" tabindex="-1" ng-style="profileStyle"></div>
</div>

<div id="ngdialog2" ng-show="contextMenuFlag.dialog_show" class="ngdialog default chatroom_topic" style="padding-top: 122px;z-index:1025">
    <div class="ngdialog-overlay"></div>
    <div class="ngdialog-content">
        <div class="dialog_hd">
            <h3 class="title">[[contextMenuFlag.dialog_name]]</h3>
        </div>
        <div class="dialog_bd" ng-show="contextMenuFlag.dialog_flag=='remark_dialog' || contextMenuFlag.dialog_flag=='group_notice' || contextMenuFlag.dialog_flag=='group_wx_name' ">
            <div id="[[contextMenuFlag.dialog_flag]]" contenteditable="true" ng-bind-html="contextMenuFlag.dialog_value" class="chatroom_name"></div>
        </div>
        <div class="dialog_bd" ng-show="contextMenuFlag.dialog_flag=='setflag'">
            <select id="setflag" name="setflag" class="form-control select2" multiple="multiple" data-placeholder="请选择标签" style="width: 100%; z-index:1026">
                <option ng-repeat="x in friendFlagList" value="[[x.dic_value]]">[[x.dic_name]]</option>
            </select>
        </div>
        <div class="img_row" ng-show="contextMenuFlag.dialog_flag=='add_member' || contextMenuFlag.dialog_flag=='del_member'" id="friend_show">
            <div class='img_show_div' name='imgvalue' ng-repeat=" member in memberList " data='[[member.wx_id]]|[[member.wx_name]]'>
                <img style='width:40px; height:40px; border: 1px solid #ddd;' src='[[member.pic]]' >
                <span title='[[member.wx_name]]' style='display:inline-block;width:40px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;font-size: 11px'>[[member.wx_name]]</span>
                <i ng-if="contextMenuFlag.dialog_flag=='del_member' && contextMenuFlag.groupOwnerId!=member.wx_id" class='icon web_wechat_delete' style='top: -65px;' onclick='delete_member();'></i>
            </div>
            <div ng-show="contextMenuFlag.dialog_flag=='add_member'"><i class='icon web_wechat_add_friends' ng-click='openSelectMemeber()'></i></div>
        </div>
        <div ng-show="contextMenuFlag.dialog_flag=='del_member' || contextMenuFlag.dialog_flag=='add_member'">已选择的成员：</div>
        <div class="img_row" ng-show="contextMenuFlag.dialog_flag=='del_member'" id="delete_member_div"></div>
        <div class="img_row" ng-show="contextMenuFlag.dialog_flag=='add_member'" id="add_member_div"></div>
        <div class="dialog_ft" style="cursor: pointer;">
            <a class="button_primary" ng-click="modifyWx(contextMenuFlag.dialog_flag,contextMenuFlag.menu_wx_id);">确定</a>
        </div>
        <div class="ngdialog-close" ng-click="contextMenuFlag.dialog_show=false" style="z-index:10"></div>
    </div>
</div>

<div id="ngdialog3" ng-show="contextMenuFlag.dialog_add_friend" class="ngdialog default chatroom_topic" style="padding-top: 50px;z-index:1026">
    <div class="ngdialog-overlay"></div>
    <div class="ngdialog-content">
        <div class="dialog_hd">
            <h3 class="title">好友选择</h3>
        </div>
        <div style="height: 500px; overflow-y: auto;overflow-x: hidden">
            <div class="friend_row">
                <input id="friend_filter" style="width:90%;margin-bottom: 10px;height: 30px;line-height: 30px;" onkeyup="memberHide()" placeholder="过滤条件" type="text"/>
            </div>
            <div class="friend_row" ng-repeat="item in allContacts | filter : {type : '!header'} | filter : {qunflag: 0} | filter : {memberflag: 0}">
                <div><input name="addMemberCheck" style="width:20px; height:40px;"  type="checkbox" data="[[item.wx_id]]|[[item.RemarkName]]|[[item.pic]]"/></div>
                <div><img style="width:40px; height:40px; border: 1px solid #ddd;" src="[[item.pic]]"></div>
                <div ng-bind-html="item.RemarkName"></div>
            </div>
        </div>

        <div class="dialog_ft" style="cursor: pointer;">
            <a class="button_primary" ng-click="addMember()">确定</a>
        </div>
        <div class="ngdialog-close" ng-click="contextMenuFlag.dialog_add_friend=false" style="z-index:10"></div>
    </div>
</div>

<div id='ngdialog_transpond' ng-if="contextMenuFlag.transpond" class='ngdialog default transpond-dialog' style='padding-top: 62.5px;'>
	<div class='ngdialog-overlay'></div>
	<div class='ngdialog-content'>
        <div class="dialog_hd">
            <h3 class="title">转发</h3>
        </div>
        <div class="dialog_bd" id="createChatRoomContainer" style="height: 480px; overflow-y: auto">
            <div id="contact-picker" data-init-list="initList" data-pick-config="pickConfig" data-select-list="selectedUsers">
                <div>
                    <!--BEGIN selector-->
                    <div class="selector">
                        <div class="contactor" ng-repeat="user in selectList">
                            <div class="avatar">
                                <img class="img" ng-src="[[user.pic]]" alt=""/>
                            </div>
                            <div class="opt"><i class="web_wechat_delete" ng-click="delUser(user.wx_id)"></i></div>
                        </div>
                        <div class="input_box">
                            <i class="addchat_searchicon"></i>
                            <input type="text" class="input" placeholder='搜索' ng-model="keyword" ng-input="search($event)" autofocus/>
                        </div>
                    </div>
                    <div id="selector_search"></div>
                    <!--END selector-->
                    <!--BEGIN contact list-->
                    <div class="chooser" ng-class="{choose2: selectList.length >= 7}">
                        <div jquery-scrollbar id="J_ContactPickerScrollBody"  class="contacts scrollbar-dynamic">
                            <!--BEGIN star contact list-->
                            <div ng-repeat="item in allContacts| filter:{RemarkName:keyword}">
                                <h4 ng-if='item.type=="header"'  class="contact_title">[[item.NickName]]</h4>
                                <div ng-if='item.type!="header"' ng-class="{active:item.wx_id==chooseWxId}">
                                    <div class="contact_item" ng-click="selectWx(item)">
                                        <div class="opt">
                                            <i ng-class="{'web_wechat_choose_wireframe':!isCheck(item.wx_id),'web_wechat_choose_green':isCheck(item.wx_id)}" class="web_wechat_choose_wireframe"></i>
                                        </div>
                                        <div class="avatar">
                                            <img class="img lazy" src="[[item.pic]]">
                                        </div>
                                        <div class="info">
                                            <h4 class="nickname ng-binding" ng-bind-html="item.RemarkName"></h4>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!--END contact list-->
                </div>
            </div>
        </div>
        <div class="dialog_ft" >
            <div ng-click="contextMenuFlag.comfirming=true" class="button button_default" ng-class="{button_primary:selectList.length&&selectList.length<=200}">确定<span ng-if="selectList.length">([[selectList.length]])</span></div>
        </div>
        <div class="ngdialog-close" style="z-index:10" ng-click="contextMenuFlag.transpond=false"></div>

        <div class="dialog-confirm" ng-show="contextMenuFlag.comfirming">
            <div class="user-container">
                <div class="users">
                    <div class="user" ng-if="$index < 14" ng-repeat="user in selectList">
                        <div class="avatar">
                            <img class="img" ng-src="[[user.pic]]" alt="">
                        </div>
                        <span ng-bind-html="user.RemarkName"></span>
                    </div>
                    <div class="user" ng-if="selectList.length>14">
                        <div class="more"></div>
                    </div>
                </div>
            </div>
            <div class="info">
                <!--<div class="count">共 <span class="num"> {{selectedUsers.length}} </span>个聊天</div>-->
                <div class="desc">确定分别发送给他们？</div>
            </div>
            <div class="buttons">
                <div class="button" ng-click="contextMenuFlag.comfirming=false">取消</div>
                <div class="button button-primary" ng-click="transpond()" ng-if="contextMenuFlag.transpond" >发送</div>
            </div>
        </div>
    </div>
</div>

<div id="ngdialog_notice" ng-show="dialog_notice" class="ngdialog_notice">
    <div class="friend_row">
        <input ng-model="keywordNotice" placeholder="查找" style="border: 1px solid rgb(223, 223, 223);padding: 0px 10px;margin: 8px 0px; height: 30px; border-radius: 30px;width: 185px;" type="text"/>
    </div>
    <div class="notice_content">
        <div style="cursor:hand" ng-click="addNoticeName(item.wx_name,item.wx_id)" class="notice_row" ng-repeat="item in memberList | filter:{wx_name:keywordNotice} | filter:{isselect: false} | filter:{wx_id: '!' +account.wx_id}">
            <div><img src="[[item.pic]]"></div>
            <div style="font-size: 12px" ng-bind-html="item.wx_name"></div>
        </div>
    </div>
</div>

<div id="ngdialog_quickReply" ng-show="dialog_quickReply" class="ngdialog_notice">
    <div class="friend_row">
        <input ng-model="keywordQuickReply" placeholder="查找" style="margin: 5px 0px 5px 0px; height: 30px; border-radius: 1px;width: 185px;" type="text"/>
    </div>
    <div class="notice_content">
        <div style="cursor:hand" ng-click="goQuickReply(item.content)" class="notice_row" ng-repeat="(itemInedx,item) in quickReplyList | filter:{content:keywordQuickReply} ">
             <div style="font-size: 12px;text-align : left;display:inline-block;width:250px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;" ng-attr-title="[[quickReplyList[itemInedx].content]]" ng-bind-html="item.content"></div>
        </div>
    </div>
</div>

<div id="videoPlayerDiv" ng-show="showVideo">
    <div class="ngdialog-close videoPlayerClose" ng-click="stopVideo()"></div>
    <video id="videoPlayer" controls="controls" class="videoPlayer"><source src="" type="video/mp4"></video>
</div>

<div ng-if="showPic" class="J_Preview" current="current" image-list="imageList">
	<div class="mask preview_mask"></div>
	<div class="img_preview_container" id="preview_container" ng-style="containerStyle" style="">
	    <div class="img_container" id="img_container">
	        <div class="img_wrp" id="img_dom" style="[[showPicStyle]]">
	            <img class="rotate0" id="img_preview" src="[[picMessage.content]]">
	            <a class="img_preview_close" title="关闭"><i ng-click="closePig()" class="web_wechat_close-window"></i></a>
	        </div>
	    </div>
	    <div class="img_opr_container" id="img_opr_container" style="display: block;">
	        <ul class="img_opr_list">
	            <li class="img_opr_item">
	                <a ng-if="prePic.length == 0" title="查看上一个"><i class="web_wechat_left web_wechat_left_disable"></i>&nbsp;</a>
                    <a ng-if="prePic.length > 0" style="cursor: hand;" ng-click="showPig(prePic)" title="查看上一个"><i class="web_wechat_left"></i>&nbsp;</a>
	            </li>
	            <li class="img_opr_item">
	                <a id="downLoadPic" download="" target="_blank" href="[[picMessage.content]]" title="下载图片"><i class="web_wechat_download"></i>&nbsp;</a>
	            </li>
	            <li class="img_opr_item">
	                <a ng-click="downloadPicture()" ng-if="downloadPic == 1" style="border:1px solid #FFFFFF; cursor: hand; margin-top:13px;">[[picMessage.taskResult]]&nbsp;</a>
	            </li>
	            <li class="img_opr_item">
	                <a ng-if="nextPic.length == 0" title="查看下一个"><i class="web_wechat_right web_wechat_right_disable"></i>&nbsp;</a>
                    <a ng-if="nextPic.length > 0" style="cursor: hand;" ng-click="showPig(nextPic)" title="查看下一个"><i class="web_wechat_right"></i>&nbsp;</a>
	            </li>
	        </ul>
	    </div>
	</div>
</div>

<!--编辑成员信息-->
<div id="ngdialogInfo" ng-show="ifEditMemberInfo" class="ngdialog default chatroom_topic" style="padding-top: 122px;z-index:1027">
    <div class="ngdialog-overlay"></div>
    <div class="ngdialog-content">
        <div class="dialog_hd">
            <h3 class="title">群成员打标</h3>
            <input type="hidden" id="extSeqId">
        </div>
        <div class="dialog_bd" style="margin:10px;">
           <label class="label" for="">姓名：</label>
            <input id="real_name" type="text" value="323px" width="80%" style="height:30px;">
         </div>
        <div class="dialog_bd" sytle="margin:10px;">
            &nbsp;&nbsp;<label class="label" for="">性别：</label>
            <span  id="sexSpan">

            </span>
        </div>
        <div class="dialog_bd" style="margin:10px;">
            <label class="label" for="">生日：</label>
         <input class="Wdate " id="birthday" style="height:30px;" type="text"  placeholder="请选择生日" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd'})">

        </div>
        <div class="dialog_bd" style="margin:10px;">
            <label class="label" for="">地区：</label>
            <select id="province" name="province" class="form-control select2" data-placeholder="请选择省份" style="width: 25%; z-index:1027">
            </select>
            <select id="city" name="city" class="form-control select2"  data-placeholder="请选择城市" style="width: 25%; z-index:1027">

            </select>
            <select id="area" name="area" class="form-control select2"  data-placeholder="请选择区县" style="width: 25%; z-index:1027">

            </select>
        </div>
        <div class="dialog_bd" style="margin:10px;">
           <label class="label" for="">地址：</label>
            <input id="address" type="text" width="80%" style="height:30px;">
         </div>
        <div class="dialog_bd" style="margin:10px;">
            <label class="label" for="">标签：</label>
            <select id="setflagMem" name="setflagMem" class="form-control select2" multiple="multiple" data-placeholder="请选择标签" style="width: 80%; z-index:1027">
                <option ng-repeat="x in friendFlagList" value="[[x.dic_value]]">[[x.dic_name]]</option>
            </select>
        </div>

        <div class="dialog_ft" style="cursor: pointer;">
            <a class="button_primary"  href="javascript:saveMemberInfoExt();">保存</a>
        </div>
        <div class="ngdialog-close" ng-click="ifEditMemberInfo=false" style="z-index:10"></div>
    </div>
</div>

<div id="mainWxMenu" class="dropdown contextMenu open" ng-show="mainWxMenuFlag.isShowMainWxMenu" ng-style="contextStyle" >
    <ul class='dropdown_menu'>
        <li><a ng-if="mainWxMenuFlag.isClearUnread" ng-click="clearUnread(mainWxMenuFlag.wx_id)" style='cursor:pointer'>一键标记消息已读</a></li>
    </ul>
</div>

<div id="welcomeMask" ng-if="welcomeMask"></div>

<script src="/static/js/common.js"></script>
<script src="/static/js/LocateDbObject.js"></script>
<script src="/static/js/wxChart-2.0.js"></script>
<script src="/static/layer/layer.js"></script>
<script src="/static/js/wxGroupMember.js"></script>
<script src="/static/plugins/iCheck/icheck.min.js"></script>
<script src="/static/plugins/My97DatePicker/WdatePicker.js"></script>
</body>
</html>