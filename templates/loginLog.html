<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>慧聊</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/dist/css/ionicons.min.css">
    <link rel="stylesheet" href="/static/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="/static/plugins/iCheck/flat/blue.css">
    <link rel="stylesheet" href="/static/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <link rel="stylesheet" href="/static/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
    <link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="/static/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="/static/plugins/iCheck/all.css">

    <link rel="stylesheet" href="/static/css/imgSize.css"/>
    <link rel="stylesheet" href="/static/tooltipster/tooltipster.bundle.min.css"/>


</head>
<body class="hold-transition sidebar-mini">

<div class="wrapper">
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper" style="margin-left: 0">
        <!-- Content Header (Page header) -->
        <section class="content">
            <h1 class="text-center">
                <br>
                登陆日志
                <br><br>
            </h1>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body p-0">
                            <table id="example3" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th style='text-align: center;'>登录IP</th>
                                    <th style='text-align: center;'>登录账号</th>
                                    <th style='text-align: center;'>上线时间</th>
                                    <th style='text-align: center;'>下线时间</th>
                                    <th style='text-align: center;'>管理微信号数</th>
                                </tr>
                                </thead>
                                <tbody id="_tableId">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div id="example2_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
                        <div class="row">
                            <div class="col-2">
                                <div class="dataTables_info" id="userListTable_info" role="status"
                                     aria-live="polite"></div>
                            </div>
                            <div class="col-1">
                                <div class="dataTables_info" id="div_pageSize" role="status" aria-live="polite"></div>
                            </div>
                            <div class="col-2">
                                <div class="dataTables_info input-group" id="div_button" role="status"
                                     aria-live="polite"></div>
                            </div>
                            <div class="col-7" style="margin-top: 8px;">
                                <div class="dataTables_paginate" id="userListTable_paginate">
                                    <ul class="pagination" id="page"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

</body>

<!-- jQuery -->
<script src="/static/plugins/jquery/jquery.js"></script>
<script src="/static/plugins/jQueryUI/jquery-ui.min.js"></script>
<script>
    $.widget.bridge('uibutton', $.ui.button)
</script>
<script src="/static/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/static/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script src="/static/plugins/fastclick/fastclick.js"></script>
<script src="/static/dist/js/adminlte.js"></script>
<script src="/static/dist/js/demo.js"></script>
<script src="/static/plugins/datatables/jquery.dataTables.js"></script>
<script src="/static/plugins/datatables/dataTables.bootstrap4.js"></script>
<script src="/static/plugins/jquery/jquery.cookie.js"></script>
<script src="/static/js/common.js"></script>
<script src="/static/dist/js/adminlte.min.js"></script>
<script src="/static/plugins/iCheck/icheck.min.js"></script>
<script src="/static/page.js"></script>

<!-- page script -->
<script>
    $(function () {
        {#        queryMachineInfo(1);#}
        queryLoginLog(1);
    });

    function queryLoginLog(pageIndex) {
        var pageSize = $("#pageSize_value").val();
        pageSize = filterNull(pageSize, 5)
        $.ajax({
            type: "POST",
            url: "{% url 'loginLog' %}",
            headers: {"X-CSRFToken": $.cookie('csrftoken')},
            data: {
                "pageIndex": pageIndex,
                "pageSize": pageSize
            },
            success: function (res) {
                severcheck(res);
                res = parseJson(res);
                $("#_tableId").empty();
                if (res) {
                    console.info(res)
                    temp = "", html = "", logout_time = "";
                    for (item in res) {
                        if (item == "pageCount") {
                            break
                        }
                        if (res[item]["logout_time"] == "None") {
                            logout_time = "";
                        } else {
                            logout_time = res[item]["logout_time"];
                        }
                        temp += "<tr><td style='text-align:center;'>" + filterNull(res[item]["IP"], " ") + "</td>";
                        temp += "<td style='text-align:center;'>" + filterNull(res[item]["oper_name"], " ") + "</td>";
                        temp += "<td style='text-align:center;'>" + filterNull(res[item]["login_time"], " ") + "</td>";
                        temp += "<td style='text-align:center;'>" + filterNull(logout_time, " ") + "</td>";
                        temp += "<td style='text-align:center;'><span class='js-title' title='" + res[item]["weixin"] + "' " +
                                "style='display:inline-block;width:80px;overflow: hidden;white-space: " +
                                "nowrap;text-overflow: ellipsis;'>" + filterNull(res[item]["weixin_count"], " ") + "</span></td>";

                    }
                    html += temp + "</tr>";
                    $("#_tableId").append(html);
                }

                $('.js-title').tooltipster();

                var pages = Math.ceil(res["pageCount"] / pageSize);
                page = {'total': res["pageCount"], 'pageNum': pageIndex, 'pages': pages};
                setPage(page, "queryLoginLog", "show");
            }
        });
    }

    function filterNull(_val, replaceVal) {
        if (replaceVal == null || replaceVal == undefined)
            replaceVal = "&nbsp;";
        if (_val == null || _val == undefined || _val == "")
            _val = replaceVal;
        return _val;
    }

</script>
<script type="text/javascript" src="/static/tooltipster/tooltipster.bundle.min.js"></script>
</body>
</html>
