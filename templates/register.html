<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册</title>

</head>
<!-- Font Awesome -->
  <link rel="stylesheet" href="/static/plugins/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="/static/dist/css/ionicons.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="/static/plugins/datatables/dataTables.bootstrap4.css">
<!-- Theme style -->
  <link rel="stylesheet" href="/static/dist/css/adminlte.min.css">
<style>

.header{
    background-color:#ffffff;
    height:98px;
    font-family: "Microsoft YaHei";
    border-bottom: 1px solid #ececec;
  }

.bod{
  background-color:#f5f5f5;
  height:800px;
   width:auto;
}

.cont{
    display: block;
    position: relative;
    font-size:28px;
    height:572px;
    width:980px;
    border:1px solid #cbc9c9;
  background-color: #ffffff;
  left:230px;
    top:36px;
}
.inf {
    left: 36px;
    top: 45px;
    color: #0076FE;
    font-family: "Microsoft YaHei";
    position: relative;
    font-size: 24px;
    text-align: left;
}
.inf2{
    left: 80px;
    top: 81px;
    width:820px;
    font-family: "Microsoft YaHei";
    position: relative;
    border-bottom: 1px solid #e0dfdf;
}
.tab{
    left:62px;
    top:113px;
    font-family: "Microsoft YaHei";
    font-size:14px;
    position: relative;
}
.button{
    font-family: "Microsoft YaHei";
    position: relative;
    font-size:18px;
    color: #ffff00;
    width:250px;
    height:50px;
    left:365px;
    bottom:-135px;
}
</style>
<body>
      <div class="header">
          <img src="/static/img/logo.png" width="59px" height="43px" style="position:absolute; left:198px; top:40px; "alt="">
          <span style="position:absolute;font-size:28px;color:#000000;left:264px;top:43px;">  慧聊新媒体营销平台 </span>
          <a href="/hl/" style="position:absolute;font-size:12px;color:#0076fe;left:1188px;top:43px;"> 返回首页</a>
        </div>
      <div class="bod">
          <div class = "cont">
              <div class = inf>
                  <img src="/static/img/icon_data_nor.png" width="24px" height="24px" style="position:relative; left:0px; top:0px; "alt="">
                  <span style="position:relative;font-size:24px;color:#0076FE;left:0px;top:0px;">  填写个人资料 </span>
              </div>
              <div class = inf2>
                  <span style="position:relative;font-size:16px;color:#5b5b5b;left:0px;top:0px;">  创建您的账号（ </span>
                  <span style="position:relative;font-size:16px;color:#fa6d11;left:0px;top:0px;">  以下信息*均为必填项，请认真填写！ </span>
                  <span style="position:relative;font-size:16px;color:#5b5b5b;left:0px;top:0px;">  ） </span>
              </div>
              <div class=tab>
                  <table border="0">
                      <tr>
                          <td align="right" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>
                            <span style="position:relative;color:#333333;left:0px;top:0px;"> 设置登录名 </span></td>
                          <td width="39px" nowrap> </td>
                          <td height="50px"><input style="width:204px" type="text" name="设置登录名" id="username" /></td>
                          <td width="15px" nowrap> </td>
                          <td style="color: red" id="usernameText"></td>

                      </tr>
                      <tr>
                          <td align="right" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>
                            <span style="position:relative;color:#333333;left:0px;top:0px;"> 姓名 </span></td>
                          <td width="39px" nowrap> </td>
                          <td height="50px"><input style="width:204px" onkeyup="isChnCheck()"  type="text" name="姓名" id="viewname" /></td>
                          <td width="15px" nowrap> </td>
                          <td style="color: red" id="viewnameText"></td>

                      </tr>
                      <tr>
                          <td align="right" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>
                            <span style="position:relative;color:#333333;left:0px;top:0px;">选择性别</span></td>
                          <td width="39px" nowrap> </td>
                          <td height="50px"><input type="radio" checked="checked" name="选择性别" value="男"> 男
                              <input type="radio" name="选择性别" value="女"> 女</td>
                      </tr>
                      <tr>
                          <td align="right" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>
                            <span style="position:relative;color:#333333;left:0px;top:0px;">请输入登录密码</span></td>
                          <td width="39px" nowrap> </td>
                          <td height="50px"><input style="width:204px" onkeyup="passwordcheck()" type="password" name="pwd" size=18px id="password"></td>
                          <td width="15px" nowrap> </td>
                          <td align="right" height="50px"><span id="passwordText" style="color: red">6-18个字符，请使用字母加数字的组合密码，不能单独使用字母、数字和符号</span></td>
                      </tr>
                      <tr>
                          <td align="left" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>
                            <span style="position:relative;color:#333333;left:0px;top:0px;"> 请输入电子邮箱 </span></td>
                          <td width="39px" nowrap> </td>
                          <td height="50px"><input style="width:204px" type="email" onblur="EmailCheck()" name="邮箱" id="email"><br /></td>
                          <td width="15px" nowrap> </td>
                          <td align="left" height="50px"><span id="emailText" style="color: red" ></span></td>
                      </tr>
                      <tr>
                          <td align="left" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>
                            <span style="position:relative;color:#333333;left:0px;top:0px;"> 请输入电话号码 </span></td>
                          <td width="39px" nowrap> </td>
                          <td height="50px"><input style="width:204px" type="text" onblur="phoneCheck()" name="手机号码" id="phone"><br /></td>
                          <td width="15px" nowrap> </td>
                          <td align="left" height="50px"><span id="phoneText" style="color: red" ></span></td>
                      </tr>
{#                      <tr>#}
{#                          <td align="right" height="50px"><span style="position:relative;color:#ff000e;left:0px;top:0px;"> *  </span>#}
{#                            <span style="position:relative;color:#333333;left:0px;top:0px;"> 组织机构 </span></td>#}
{#                          <td width="39px" nowrap> </td>#}
{#                          <td height="50px"><select id="organization" class="form-control select2 select2-hidden-accessible" tabindex="-1" aria-hidden="true">#}
{#                                    {% for item in organizationList %}#}
{#                                        <option value={{item.name}}>{{item.name}}</option>#}
{#                                    {% endfor %}#}
{#                                </select></td>#}
{#                          <td width="15px" nowrap> </td>#}
{#                          <td align="left" height="50px"></td>#}
{#                      </tr>#}
                  </table>
              </div>
              <div class="button" align="center">
                      <button id="reg_submit" type="submit" style=" width: 250px;border-radius:5px;height: 50px;font-size:18px; background-color:#0076fe;color: #ffffff">提  交</button>
                  </div>
          </div>
      </div>
</body>
<script src="/static/plugins/jquery/jquery.min.js"></script>
<script src="/static/js/md5.js"></script>

<script>
    $("#reg_submit").click(function(){
        var username = $("#username").val();
        var sex = $('input[name=选择性别]:checked').val();
        var password = $("#password").val();
        var email = $("#email").val();
        var phone = $("#phone").val();
        var viewname = $("#viewname").val();
        {#var organization = $("#organization").val();#}
        if(username.trim() == ""){
            alert("请输入用户名");
            return false;
        }
        if(viewname.trim() == ""){
            alert("请输入正确的姓名");
            return false;
        }
        if(sex.trim() == ""){
            alert("请选择性别");
            return false;
        }
        if(password.trim() == ""){
            alert("请输入密码");
            return false;
        }
        if(email.trim() == ""){
            alert("请输入正确的邮箱");
            return false;
        }
        {#if(organization.trim() == ""){#}
        {#    alert("请选择组织机构");#}
        {#    return false;#}
        {#}#}
        if(phone.trim() == ""){
            alert("请输入正确的手机号码");
            return false;
        }
        if(passwordcheck() == false){
            return false;
        }
        if(EmailCheck() == false){
            return false;
        }
        if($("#usernameText").html() == "用户名已存在"){
            alert("用户名已存在！");
            return false;
        }
        if(passwordcheck() == false || EmailCheck() == false || phoneCheck() == false || isChnCheck() == false){
            alert("请正确完善个人资料信息")
            return false;
        }
        password=hex_md5(password);
        if(sex=="男")
        {
            sex="1";
        }
        else
        {
            sex="2";
        }
        $.ajax({
            url: "{% url 'reg_submit' %}",
            type: "POST",
            dataType:'json',
            data: {"username":username,
                "sex":sex,
                "password":password,
                "email":email,
                "oper":"regist",
                "phone":phone,
                "viewname":viewname},
            success: function (data) {
                if(data){
                    if(data.result == "1"){
                        alert("注册成功！");
                        window.location.href="/examine";
                    }
                    else{
                        alert("注册失败！");
                    }
                }
            }
        })
    });

    $("#username").blur(function() {
        var username=$("#username").val();
        if(username.trim() != ""){
            $.ajax({
                url: "{% url 'reg_submit' %}",
                type: "POST",
                dataType: 'json',
                data: {"username":username, "oper":"checkusername"},
                success: function (data) {
                    var hint=data.result;
                    $("#usernameText").html(hint);
                }

            });
        }
    });

    function passwordcheck()
    {
        var password = $("#password").val();
        var hint="";
        if(password.length < 6 || password.length >18 ){
            hint="<img src='/static/img/icon_error_nor.png'>  密码长度不符合要求，必须6-18个字符";
            $("#passwordText").html(hint);
            return false;
        }
        var isNumber=0;
        var ischar=0;
        var isOther=0;
        for (i=0;i<password.length;i++){
            //密码模式
            iN = password.charCodeAt(i);
            //判断输入密码的类型
            if (iN>=48 && iN <=57) //数字
                isNumber=1;
            else if (iN>=65 && iN <=90) //大写
                ischar=1;
            else if (iN>=97 && iN <=122) //小写
                ischar=1;
            else
                isOther=1;
        }
        if (isNumber+ischar+isOther<=1){
            hint = "<img src='/static/img/icon_error_nor.png'>  不能单独使用字母、数字和符号";
            $("#passwordText").html(hint);
            return false;
        }
        hint = "<img src='/static/img/icon_correct_nor.png'>";

        $("#passwordText").html(hint);
        return true;
    }

    function EmailCheck() {
        var myemail = $("#email").val();
        var myReg = /^[a-zA-Z0-9_-]+@([a-zA-Z0-9]+\.)+(com|cn|net|org)$/;
        var hint = "";

        if (myReg.test(myemail)) {
            hint = "<img src='/static/img/icon_correct_nor.png'>";
            $("#emailText").html(hint);
            return true;
        } else {
            hint = "<img src='/static/img/icon_error_nor.png'>  电子邮箱不符合要求";
            $("#emailText").html(hint);
            return false;
        }
    }
    function phoneCheck() {
        var phone = $("#phone").val();
        var phoneReg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/;
        if (phoneReg.test(phone)) {
             hint = "<img src='/static/img/icon_correct_nor.png'>";
             $("#phoneText").html(hint);
            return true;
        } else {
            hint = "<img src='/static/img/icon_error_nor.png'>  手机号码不符合要求";
            $("#phoneText").html(hint);
            return false;
        }
    }
    function isChnCheck() {
        var viewname = $("#viewname").val();
        {#var reg = /.*[\\u4e00-\\u9fa5]+.*$/;#}
        var reg = new RegExp("[\\u4E00-\\u9FFF]+","g");
        if (reg.test(viewname)) {

            hint = "<img src='/static/img/icon_correct_nor.png'>";
            $("#viewnameText").html(hint);
            return true;
        } else {

           hint = "<img src='/static/img/icon_error_nor.png'>  姓名需为中文";
            $("#viewnameText").html(hint);
            return false;
        }
    }
</script>

</html>